<!DOCTYPE html>
<meta charset="utf-8">
<style>
    .chart rect {
        fill: steelblue;
    }

    .chart text {
        fill: white;
        font: 10px;
        text-anchor: middle;
    }

    .colHead {
        font: 24px Helvetica Neue;
        fill: #a00;
    }

    .rowHead {
        font: 24px Helvetica Neue;
        fill: #00a;
    }

    .title {
        font: 32px Helvetica Neue;
        color: #666;
    }
</style>

<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>

<script>

    var w = 240;
    var h = 150;
    var margin = { top: 10, right: 10, bottom: 10, left: 10 };

    function colLabel(label) {
        var svg = d3.select("body").append("svg")
            .attr("width", w)
            .attr("height", h / 3)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var title = svg.append("text")
            .attr("class", "colHead")
            .attr("dy", ".71em")
            .text(label);
    }

    function rowLabel(label) {
        var svg = d3.select("body").append("svg")
            .attr("width", w)
            .attr("height", h)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var title = svg.append("text")
            .attr("class", "rowHead")
            .attr("dy", ".71em")
            .text(label);
    }

    function drawGraph(label) {
        var width = w - margin.left - margin.right;
        var height = h - margin.top - margin.bottom;

        var chart = d3.select("body").append("svg")
            .attr("width", w)
            .attr("height", h)
            .append("g")
            .attr("class", "chart")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var y = d3.scale.linear()
            .range([height, 0]);

        d3.csv("statistics.txt", type, function (error, data) {
            y.domain([0, d3.max(data, function (d) { return d.value; })]);

            var barWidth = width / data.length;

            var bar = chart.selectAll("g")
                .data(data)
                .enter().append("g")
                .attr("transform", function (d, i) { return "translate(" + i * barWidth + ",0)"; });

            bar.append("rect")
                .attr("y", function (d) { return y(d.value); })
                .attr("height", function (d) { return height - y(d.value); })
                .attr("width", barWidth - 1);

            bar.append("text")
                .attr("x", barWidth / 2)
                .attr("y", function (d) { return y(d.value) + 3; })
                .attr("dy", ".75em")
                .text(function (d) { return d.container; });
        });
    }

    function type(d) {
        d.value = +d.value; // coerce to number
        return d;
    }
</script>


<script>
    function drawGraphs(keyType, valueSize, constructType, lookupType) {
        document.write("<p>")
        colLabel("");
        colLabel("10 elements");
        colLabel("100 elements");
        colLabel("1,000 elements");
        colLabel("10,000 elements");
        document.write("</p>")

        document.write("<p>")
        rowLabel("10 lookups");
        drawGraph("1");
        document.write("</p>")

        document.write("<p>")
        rowLabel("100 lookups");
        drawGraph("1");
        drawGraph("2");
        document.write("</p>")

        document.write("<p>")
        rowLabel("1,000 lookups");
        drawGraph("1");
        drawGraph("2");
        drawGraph("3");
        document.write("</p>")

        document.write("<p>")
        rowLabel("10,000 lookups");
        drawGraph("1");
        drawGraph("2");
        drawGraph("3");
        drawGraph("4");
        document.write("</p>")

        document.write("<p>")
        rowLabel("100,000 lookups");
        drawGraph("1");
        drawGraph("2");
        drawGraph("3");
        drawGraph("4");
        document.write("</p>")
    }
</script>

<body>
    <p class="title"> Integer key, 4 bytes value, construct once, lookup continuously</p>
    <script>drawGraphs("integer", 4, 0, 0);</script>
    <hr />

    <p class="title"> Integer key, 4 bytes value, construct once, lookup sporadically</p>
    <script>drawGraphs("integer", 4, 0, 1);</script>
    <hr />
</body>
